import {GameEvent} from '@the-game/common/dist/enum/websockets/events/game-event.enum';
import {GameInterventionDto} from '@the-game/common/dist/types/game/GameInterventionDto';
import {useEffect, useState} from 'react';
import {WsListener} from '../../../../common/websocket/websocket.manager';
import useWebSocket from '../../../../hooks/useWebSocket';

type SaveDownIconProps = {
    stackIndex: number;
};

export const SaveDownIcon = (props: SaveDownIconProps) => {
    const {wsm} = useWebSocket();
    const [animation, setAnimation] = useState(false);

    useEffect(() => {
        const onBlockIntervention: WsListener<GameInterventionDto> = (
            intervention: GameInterventionDto
        ) => {
            if (intervention.stackIndex !== props.stackIndex) return;
            setAnimation(true);
        };

        wsm.registerListener(GameEvent.SAVE_INTERVENTION, onBlockIntervention);

        return () => {
            wsm.removeListener(
                GameEvent.SAVE_INTERVENTION,
                onBlockIntervention
            );
        };
    });

    return (
        <svg
            viewBox="0 0 115 131"
            fill="none"
            className={`h-full m-auto p-0.5 dark:fill-white fill-black ${
                animation && 'animate-grow'
            }`}
            onAnimationEnd={() => setAnimation(false)}
            xmlns="http://www.w3.org/2000/svg"
        >
            <path d="M35.7049 13.0181C27.9071 15.1672 20.1622 17.5041 12.477 20.0266C11.7752 20.2539 11.1514 20.6738 10.6766 21.2383C10.2018 21.8029 9.89514 22.4894 9.79148 23.2197C5.25561 57.2552 15.7356 82.0879 28.2379 98.4465C33.5313 105.442 39.8429 111.604 46.9627 116.729C49.7956 118.727 52.301 120.168 54.2742 121.093C55.2567 121.56 56.059 121.871 56.6731 122.059C56.9417 122.153 57.2185 122.222 57.5 122.264C57.7782 122.219 58.0521 122.15 58.3188 122.059C58.941 121.871 59.7434 121.56 60.7259 121.093C62.6909 120.168 65.2045 118.719 68.0374 116.729C75.1571 111.604 81.4687 105.442 86.7622 98.4465C99.2645 82.0961 109.744 57.2552 105.209 23.2197C105.106 22.4891 104.8 21.8021 104.325 21.2374C103.85 20.6727 103.225 20.2531 102.523 20.0266C97.193 18.2827 88.195 15.4416 79.2952 13.0263C70.207 10.5619 61.8476 8.73606 57.5 8.73606C53.1607 8.73606 44.793 10.5537 35.7049 13.0181ZM33.527 4.585C42.4105 2.16969 51.8507 0 57.5 0C63.1494 0 72.5896 2.16969 81.4731 4.585C90.5612 7.04125 99.723 9.94781 105.11 11.7081C107.363 12.452 109.36 13.8161 110.872 15.6439C112.384 17.4716 113.35 19.6888 113.658 22.0407C118.538 58.6962 107.215 85.8623 93.4759 103.834C87.65 111.522 80.7034 118.292 72.868 123.918C70.1587 125.865 67.2881 127.577 64.2875 129.035C61.995 130.116 59.5305 131 57.5 131C55.4695 131 53.0133 130.116 50.7126 129.035C47.712 127.577 44.8414 125.865 42.1321 123.918C34.2969 118.292 27.3502 111.522 21.5242 103.834C7.78554 85.8623 -3.53777 58.6962 1.34198 22.0407C1.65055 19.6888 2.61631 17.4716 4.12833 15.6439C5.64034 13.8161 7.63728 12.452 9.88973 11.7081C17.7104 9.14387 25.5918 6.76881 33.527 4.585Z" />
            <path d="M61.385 100.78L82.1694 77.1518C84.6223 74.3627 82.6288 70 78.9061 70H37.3374C36.5043 69.9993 35.6886 70.2375 34.9881 70.686C34.2875 71.1346 33.7318 71.7745 33.3875 72.5292C33.0431 73.2839 32.9248 74.1212 33.0466 74.9411C33.1683 75.7609 33.5251 76.5285 34.0741 77.1518L54.8585 100.776C55.2653 101.239 55.7669 101.61 56.3297 101.864C56.8926 102.118 57.5036 102.25 58.1218 102.25C58.7399 102.25 59.3509 102.118 59.9138 101.864C60.4766 101.61 60.9783 101.243 61.385 100.78Z" />
            <path d="M61.0388 69.085L76.627 51.3639C78.4667 49.272 76.9716 46 74.1796 46H43.0031C42.3782 45.9995 41.7665 46.1781 41.241 46.5145C40.7156 46.851 40.2989 47.3309 40.0406 47.8969C39.7823 48.4629 39.6936 49.0909 39.7849 49.7058C39.8763 50.3207 40.1438 50.8964 40.5556 51.3639L56.1439 69.0818C56.4489 69.4291 56.8252 69.7074 57.2473 69.8981C57.6694 70.0888 58.1277 70.1875 58.5913 70.1875C59.0549 70.1875 59.5132 70.0888 59.9353 69.8981C60.3575 69.7074 60.7337 69.4323 61.0388 69.085Z" />
            <path d="M60.2166 45.3138L71.9078 32.0229C73.2875 30.454 72.1662 28 70.0722 28L46.6898 28C46.2212 27.9996 45.7623 28.1336 45.3683 28.3859C44.9742 28.6382 44.6616 28.9982 44.468 29.4227C44.2743 29.8472 44.2077 30.3182 44.2762 30.7794C44.3447 31.2405 44.5454 31.6723 44.8542 32.0229L56.5454 45.3114C56.7742 45.5718 57.0564 45.7806 57.373 45.9236C57.6896 46.0666 58.0333 46.1406 58.381 46.1406C58.7287 46.1406 59.0724 46.0666 59.389 45.9236C59.7056 45.7806 59.9878 45.5742 60.2166 45.3138Z" />
        </svg>
    );
};
