import {GameEvent} from '@the-game/common/dist/enum/websockets/events/game-event.enum';
import {GameInterventionDto} from '@the-game/common/dist/types/game/GameInterventionDto';
import {useEffect, useState} from 'react';
import {WsListener} from '../../../../common/websocket/websocket.manager';
import useWebSocket from '../../../../hooks/useWebSocket';

type SaveUpIconProps = {
    stackIndex: number;
};

export const SaveUpIcon = (props: SaveUpIconProps) => {
    const {wsm} = useWebSocket();
    const [animation, setAnimation] = useState(false);

    useEffect(() => {
        const onBlockIntervention: WsListener<GameInterventionDto> = (
            intervention: GameInterventionDto
        ) => {
            if (intervention.stackIndex !== props.stackIndex) return;
            setAnimation(true);
        };

        wsm.registerListener(GameEvent.SAVE_INTERVENTION, onBlockIntervention);

        return () => {
            wsm.removeListener(
                GameEvent.SAVE_INTERVENTION,
                onBlockIntervention
            );
        };
    });

    return (
        <svg
            viewBox="0 0 115 131"
            fill="none"
            className={`h-full m-auto p-0.5 dark:fill-white fill-black ${
                animation && 'animate-grow'
            }`}
            onAnimationEnd={() => setAnimation(false)}
            xmlns="http://www.w3.org/2000/svg"
        >
            <path d="M35.7049 13.0181C27.9071 15.1672 20.1622 17.5041 12.477 20.0266C11.7752 20.2539 11.1514 20.6738 10.6766 21.2383C10.2018 21.8029 9.89514 22.4894 9.79148 23.2197C5.25561 57.2552 15.7356 82.0879 28.2379 98.4465C33.5313 105.442 39.8429 111.604 46.9627 116.729C49.7956 118.727 52.301 120.168 54.2742 121.093C55.2567 121.56 56.059 121.871 56.6731 122.059C56.9417 122.153 57.2185 122.222 57.5 122.264C57.7782 122.219 58.0521 122.15 58.3188 122.059C58.941 121.871 59.7434 121.56 60.7259 121.093C62.6909 120.168 65.2045 118.719 68.0374 116.729C75.1571 111.604 81.4687 105.442 86.7622 98.4465C99.2645 82.0961 109.744 57.2552 105.209 23.2197C105.106 22.4891 104.8 21.8021 104.325 21.2374C103.85 20.6727 103.225 20.2531 102.523 20.0266C97.193 18.2827 88.195 15.4416 79.2952 13.0263C70.207 10.5619 61.8476 8.73606 57.5 8.73606C53.1607 8.73606 44.793 10.5537 35.7049 13.0181ZM33.527 4.585C42.4105 2.16969 51.8507 0 57.5 0C63.1494 0 72.5896 2.16969 81.4731 4.585C90.5612 7.04125 99.723 9.94781 105.11 11.7081C107.363 12.452 109.36 13.8161 110.872 15.6439C112.384 17.4716 113.35 19.6888 113.658 22.0407C118.538 58.6962 107.215 85.8623 93.4759 103.834C87.65 111.522 80.7034 118.292 72.868 123.918C70.1587 125.865 67.2881 127.577 64.2875 129.035C61.995 130.116 59.5305 131 57.5 131C55.4695 131 53.0133 130.116 50.7126 129.035C47.712 127.577 44.8414 125.865 42.1321 123.918C34.2969 118.292 27.3502 111.522 21.5242 103.834C7.78554 85.8623 -3.53777 58.6962 1.34198 22.0407C1.65055 19.6888 2.61631 17.4716 4.12833 15.6439C5.64034 13.8161 7.63728 12.452 9.88973 11.7081C17.7104 9.14387 25.5918 6.76881 33.527 4.585Z" />
            <path d="M54.865 29.4699L34.0806 53.0982C31.6277 55.8873 33.6212 60.25 37.3439 60.25H78.9126C79.7457 60.2507 80.5614 60.0125 81.2619 59.564C81.9625 59.1154 82.5182 58.4755 82.8625 57.7208C83.2069 56.9661 83.3252 56.1288 83.2034 55.3089C83.0817 54.4891 82.7249 53.7215 82.1759 53.0982L61.3915 29.4743C60.9847 29.0112 60.4831 28.6401 59.9203 28.3858C59.3574 28.1316 58.7464 28 58.1282 28C57.5101 28 56.8991 28.1316 56.3362 28.3858C55.7734 28.6401 55.2717 29.0069 54.865 29.4699Z" />
            <path d="M56.1487 61.3525L40.5605 79.0736C38.7208 81.1655 40.2159 84.4375 43.0079 84.4375H74.1844C74.8093 84.438 75.421 84.2594 75.9465 83.923C76.4719 83.5865 76.8886 83.1066 77.1469 82.5406C77.4052 81.9746 77.4939 81.3466 77.4026 80.7317C77.3112 80.1168 77.0437 79.5411 76.6319 79.0736L61.0436 61.3557C60.7386 61.0084 60.3623 60.7301 59.9402 60.5394C59.5181 60.3487 59.0598 60.25 58.5962 60.25C58.1326 60.25 57.6743 60.3487 57.2522 60.5394C56.83 60.7301 56.4538 61.0052 56.1487 61.3525Z" />
            <path d="M56.549 85.0768L44.8578 98.3677C43.4781 99.9366 44.5994 102.391 46.6934 102.391H70.0758C70.5445 102.391 71.0033 102.257 71.3973 102.005C71.7914 101.752 72.104 101.392 72.2977 100.968C72.4914 100.543 72.5579 100.072 72.4894 99.6113C72.4209 99.1501 72.2203 98.7183 71.9114 98.3677L60.2202 85.0793C59.9914 84.8188 59.7092 84.6101 59.3926 84.467C59.076 84.324 58.7323 84.25 58.3846 84.25C58.0369 84.25 57.6932 84.324 57.3766 84.467C57.06 84.6101 56.7779 84.8164 56.549 85.0768Z" />
        </svg>
    );
};
